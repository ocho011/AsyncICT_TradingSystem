# 모의 거래(Dry Run) 테스트 실행 제안

**날짜:** 2025-09-01

**작성자:** Gemini

## 1. 개요

새로운 기능(데이터베이스, 테스트, 시각화 등)을 추가하기에 앞서, 현재까지 구현된 시스템의 핵심 매매 로직이 의도대로 정확하게 작동하는지 검증할 필요가 있습니다.

실제 자금의 위험 없이 전체 시스템의 파이프라인을 안전하게 테스트하기 위해 **모의 거래(Dry Run) 기능**을 도입하고, 이를 활용한 테스트를 실행할 것을 제안합니다.

## 2. 테스트 실행 계획

### Step 1: `config.ini`에 모의 거래 설정 추가
- `config.ini` 파일에 `[trading]` 섹션 (또는 `[execution]` 섹션)을 만들고 `dry_run` 플래그를 추가합니다.
- 이 플래그를 통해 실제 주문과 모의 주문을 손쉽게 전환할 수 있습니다.

**예시 `config.ini`:**
```ini
[trading]
symbol = BTCUSDT
# ... 다른 설정들 ...
dry_run = true  # true: 모의 거래, false: 실제 거래
```

### Step 2: `AsyncOrderManager` 로직 수정
- `infrastructure/binance/AsyncOrderManager.py` 파일을 수정합니다.
- 주문 실행 메서드(`_execute_order` 등)가 시작될 때 `config.ini`의 `dry_run` 설정을 확인하도록 변경합니다.
- **`dry_run = true`일 경우:**
    - 실제 바이낸스 API를 호출하는 대신, 실행하려던 주문의 상세 정보(심볼, 수량, 가격, 포지션 방향 등)를 로그 파일에 기록합니다.
    - 주문이 즉시 '성공적으로 체결되었다'고 가정하고 다음 로직을 진행시킵니다.
- **`dry_run = false`일 경우:**
    - 기존과 동일하게 실제 바이낸스 API를 호출하여 주문을 실행합니다.

### Step 3: 시스템 실행 및 로그 분석
- `dry_run` 모드가 활성화된 상태에서 `main.py`를 실행합니다.
- 생성되는 로그 파일(`logs/trading_system.log`)을 실시간으로 모니터링하며 아래 항목들을 검증합니다.
    1.  **데이터 수신:** 바이낸스 웹소켓으로부터 `CandleEvent`가 정상적으로 수신되는가?
    2.  **분석 모듈 작동:** `AsyncFVGDetector`, `AsyncOrderBlockDetector` 등이 이벤트를 받아 분석을 수행하고 로그를 남기는가?
    3.  **전략 판단:** `AsyncStrategyCoordinator`가 분석 결과를 종합하여 `PreliminaryTradeDecision` 이벤트를 발생시키는가?
    4.  **리스크 관리:** `AsyncRiskManager`가 포지션 사이즈를 계산하고 `ApprovedTradeOrder` 이벤트를 발생시키는가?
    5.  **모의 주문 기록:** `AsyncOrderManager`가 최종적으로 실제 주문 대신 **"DRY RUN: Placing BUY order for 0.1 BTC at 50000.0"** 과 같은 상세한 로그를 남기는가?

## 3. 기대 효과

- 실제 자금 손실의 위험 없이, 데이터 수신부터 최종 주문 결정까지의 전체 로직 흐름을 검증할 수 있습니다.
- 각 분석 및 실행 모듈이 의도한 대로 상호작용하는지 확인할 수 있습니다.
- 향후 기능 개발에 앞서 현재 시스템의 안정성에 대한 확신을 가질 수 있습니다.
